generator client {
  provider = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "fullTextIndex"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  relationMode = "prisma"
}

// ============================================
// BRANCH & LOCATION MANAGEMENT
// ============================================

model Branch {
  id          String   @id @default(cuid())
  name        String   @db.VarChar(100)
  slug        String   @unique @db.VarChar(100)
  location    String?  @db.VarChar(255)
  address     String?  @db.Text
  city        String?  @db.VarChar(100)
  country     String   @default("Rwanda") @db.VarChar(100)
  phone       String?  @db.VarChar(20)
  email       String?  @db.VarChar(100)
  website     String?  @db.VarChar(255)
  timezone    String   @default("Africa/Kigali") @db.VarChar(50)
  currency    String   @default("RWF") @db.VarChar(3)
  isActive    Boolean  @default(true)
  isFeatured  Boolean  @default(false)
  managerId   String?  @db.VarChar(50)
  latitude    Float?
  longitude   Float?
  rating      Float    @default(0) @db.Float
  totalRooms  Int      @default(0)
  imageUrl    String?  @db.Text
  description String?  @db.Text
  amenities   Json?
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  rooms         Room[]
  bookings      Booking[]
  orders        Order[]
  menuItems     MenuItem[]
  events        Event[]
  services      Service[]
  inventory     Inventory[]
  expenses      Expense[]
  notifications Notification[]
  messages      Message[]
  contacts      Contact[]
  pageContents  PageContent[]
  staff         Staff[]
  guests        Guest[]
  payments      Payment[]
  tables        RestaurantTable[]
  reviews       Review[]
  invoices      Invoice[]
  taxes         Tax[]
  priceRules    PriceRule[]
  activityLogs  ActivityLog[]
  promotions    Promotion[]
  analytics     Analytics[]
  heroContents  HeroContent[]
  suppliers     Supplier[]
  stockItems    StockItem[]
  purchaseOrders PurchaseOrder[]
  managerAssignments ManagerAssignment[]

  @@index([slug])
  @@index([isActive])
  @@index([city])
  @@map("branches")
}

// ============================================
// MANAGER ASSIGNMENT & ROLE HIERARCHY
// ============================================

model ManagerAssignment {
  id             String    @id @default(cuid())
  managerId      String    @db.VarChar(50)
  branchId       String    @db.VarChar(50)
  assignedBy     String?   @db.VarChar(50)
  assignedAt     DateTime  @default(now())
  canManageMenu  Boolean   @default(true)
  canManageStaff Boolean   @default(true)
  canManageRevenue Boolean @default(true)
  permissions    Json?
  isActive       Boolean   @default(true)
  notes          String?   @db.Text
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  manager Manager  @relation(fields: [managerId], references: [id], onDelete: Cascade)
  branch  Branch   @relation(fields: [branchId], references: [id], onDelete: Cascade)

  @@unique([managerId, branchId])
  @@index([managerId])
  @@index([branchId])
  @@index([isActive])
  @@map("manager_assignments")
}

model Manager {
  id                 String    @id @default(cuid())
  name               String    @db.VarChar(100)
  email              String    @unique @db.VarChar(100)
  phone              String?   @db.VarChar(20)
  avatar             String?   @db.Text
  level              String    @default("manager") @db.VarChar(50) // manager, senior_manager, super_manager
  password           String?   @db.VarChar(255)
  isActive           Boolean   @default(true)
  totalBranches      Int       @default(0)
  lastLogin          DateTime?
  loginCount         Int       @default(0)
  twoFactorEnabled   Boolean   @default(false)
  mustChangePassword Boolean   @default(false)
  preferences        Json?
  metadata           Json?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  assignments ManagerAssignment[]

  @@index([email])
  @@index([level])
  @@index([isActive])
  @@map("managers")
}

// ============================================
// STAFF & USER MANAGEMENT
// ============================================

model Staff {
  id                 String    @id @default(cuid())
  name               String    @db.VarChar(100)
  email              String    @unique @db.VarChar(100)
  password           String?   @db.VarChar(255)
  phone              String?   @db.VarChar(20)
  role               String    @db.VarChar(50) // waiter, stock_manager, receptionist, kitchen_staff, manager
  department         String    @db.VarChar(50) // restaurant, reception, kitchen, housekeeping, stock
  shift              String?   @db.VarChar(20) // morning, afternoon, night
  status             String    @default("active") @db.VarChar(20) // active, inactive, on_leave
  avatar             String?   @db.Text
  branchId           String    @db.VarChar(50)
  salary             Float?    @db.Float
  hireDate           DateTime  @default(now())
  lastLogin          DateTime?
  loginCount         Int       @default(0)
  mustChangePassword Boolean   @default(false)
  twoFactorEnabled   Boolean   @default(false)
  reportsTo          String?   @db.VarChar(50) // manager/supervisor ID
  idNumber           String?   @db.VarChar(50)
  createdBy          String?   @db.VarChar(50)
  activityStatus     String    @default("online") @db.VarChar(20) // online, offline, busy
  lastActivityAt     DateTime?
  permissions        Json?
  preferences        Json?
  metadata           Json?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  branch        Branch        @relation(fields: [branchId], references: [id], onDelete: Cascade)
  activityLogs  ActivityLog[]
  ordersCreated Order[]       @relation("OrderCreator")
  assignments   Assignment[]

  @@index([email])
  @@index([branchId])
  @@index([role])
  @@index([department])
  @@index([status])
  @@map("staff")
}

model Guest {
  id              String    @id @default(cuid())
  name            String    @db.VarChar(100)
  email           String    @unique @db.VarChar(100)
  phone           String?   @db.VarChar(20)
  avatar          String?   @db.Text
  nationality     String?   @db.VarChar(50)
  idType          String?   @db.VarChar(20)
  idNumber        String?   @db.VarChar(50)
  dateOfBirth     DateTime?
  gender          String?   @db.VarChar(10)
  address         String?   @db.Text
  city            String?   @db.VarChar(100)
  country         String?   @db.VarChar(100)
  postalCode      String?   @db.VarChar(20)
  loyaltyTier     String    @default("bronze") @db.VarChar(20)
  loyaltyPoints   Int       @default(0)
  totalStays      Int       @default(0)
  totalSpent      Float     @default(0) @db.Float
  avgRating       Float     @default(0) @db.Float
  lastVisit       DateTime?
  preferences     Json?
  specialRequests String?   @db.Text
  isVip           Boolean   @default(false)
  isBlacklisted   Boolean   @default(false)
  notes           String?   @db.Text
  branchId        String    @db.VarChar(50)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  branch   Branch    @relation(fields: [branchId], references: [id], onDelete: Cascade)
  bookings Booking[]
  orders   Order[]
  reviews  Review[]

  @@index([email])
  @@index([branchId])
  @@index([loyaltyTier])
  @@index([isVip])
  @@map("guests")
}

// ============================================
// ROOM & ACCOMMODATION
// ============================================

model Room {
  id              String   @id @default(cuid())
  number          String   @db.VarChar(20)
  floor           Int
  type            String   @db.VarChar(50)
  status          String   @default("available") @db.VarChar(20)
  price           Float    @db.Float
  weekendPrice    Float?   @db.Float
  description     String?  @db.Text
  imageUrl        String?  @db.Text
  images          Json?
  maxOccupancy    Int      @default(2)
  bedType         String?  @db.VarChar(20)
  bedCount        Int      @default(1)
  size            Int?
  view            String?  @db.VarChar(50)
  hasBalcony      Boolean  @default(false)
  hasKitchen      Boolean  @default(false)
  smokingAllowed  Boolean  @default(false)
  petFriendly     Boolean  @default(false)
  accessible      Boolean  @default(false)
  rating          Float    @default(0) @db.Float
  totalBookings   Int      @default(0)
  lastCleaned     DateTime?
  lastMaintenance DateTime?
  features        Json?
  branchId        String   @db.VarChar(50)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  branch        Branch        @relation(fields: [branchId], references: [id], onDelete: Cascade)
  bookings      Booking[]
  orders        Order[]
  roomAmenities RoomAmenity[]
  reviews       Review[]

  @@unique([number, branchId])
  @@index([branchId])
  @@index([status])
  @@index([type])
  @@index([price])
  @@map("rooms")
}

model RoomAmenity {
  id       String  @id @default(cuid())
  roomId   String  @db.VarChar(50)
  amenity  String  @db.VarChar(100)
  icon     String? @db.VarChar(50)
  category String? @db.VarChar(50)

  room Room @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@index([roomId])
  @@map("room_amenities")
}

// ============================================
// BOOKING & RESERVATION
// ============================================

model Booking {
  id              String    @id @default(cuid())
  bookingRef      String    @unique @db.VarChar(50)
  guestName       String    @db.VarChar(100)
  guestEmail      String    @db.VarChar(100)
  guestPhone      String?   @db.VarChar(20)
  guestAvatar     String?   @db.Text
  roomId          String    @db.VarChar(50)
  roomNumber      String    @db.VarChar(20)
  roomType        String    @db.VarChar(50)
  checkIn         DateTime
  checkOut        DateTime
  nights          Int       @default(1)
  adults          Int       @default(1)
  children        Int       @default(0)
  infants         Int       @default(0)
  numberOfGuests  Int       @default(1)
  status          String    @default("pending") @db.VarChar(20)
  source          String    @default("website") @db.VarChar(50)
  totalAmount     Float     @db.Float
  paidAmount      Float     @default(0) @db.Float
  discountAmount  Float     @default(0) @db.Float
  taxAmount       Float     @default(0) @db.Float
  paymentMethod   String?   @db.VarChar(50)
  paymentStatus   String    @default("pending") @db.VarChar(20)
  specialRequests String?   @db.Text
  addOns          Json?
  checkedInAt     DateTime?
  checkedOutAt    DateTime?
  cancelledAt     DateTime?
  cancellationReason String? @db.Text
  rating          Float?    @db.Float
  reviewText      String?   @db.Text
  branchId        String    @db.VarChar(50)
  guestId         String?   @db.VarChar(50)
  promotionId     String?   @db.VarChar(50)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  room      Room       @relation(fields: [roomId], references: [id])
  branch    Branch     @relation(fields: [branchId], references: [id], onDelete: Cascade)
  guest     Guest?     @relation(fields: [guestId], references: [id])
  promotion Promotion? @relation(fields: [promotionId], references: [id])
  payments  Payment[]
  invoice   Invoice?

  @@index([bookingRef])
  @@index([branchId])
  @@index([guestId])
  @@index([status])
  @@index([checkIn])
  @@index([checkOut])
  @@map("bookings")
}

// ============================================
// PAYMENT & INVOICING
// ============================================

model Payment {
  id            String   @id @default(cuid())
  bookingId     String?  @map("booking_id")
  orderId       String?  @map("order_id")
  eventId       String?  @map("event_id")
  amount        Float
  currency      String   @default("RWF")
  status        String   @default("pending") // pending, processing, completed, failed, refunded
  paymentMethod String?  @map("payment_method") // card, mobile_money, cash, bank_transfer, wallet
  paymentType   String   @default("booking") // booking, order, event, service
  transactionId String?  @map("transaction_id")
  gateway       String? // stripe, flutterwave, paypal, mtn_momo, airtel_money
  gatewayRef    String?  @map("gateway_ref")
  guestName     String?  @db.VarChar(100)
  guestEmail    String?  @db.VarChar(100)
  guestPhone    String?  @db.VarChar(20)
  processedBy   String?  @db.VarChar(50) // staff ID who processed
  paidAt        DateTime?
  notes         String?  @db.Text
  receiptUrl    String?  @db.Text
  metadata      Json?
  branchId      String   @db.VarChar(50)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  booking Booking? @relation(fields: [bookingId], references: [id])
  branch  Branch   @relation(fields: [branchId], references: [id])

  @@index([bookingId])
  @@index([orderId])
  @@index([eventId])
  @@index([status])
  @@index([paymentMethod])
  @@index([paymentType])
  @@index([branchId])
  @@index([createdAt])
  @@map("payments")
}

model Invoice {
  id            String    @id @default(cuid())
  invoiceNumber String    @unique @map("invoice_number") // e.g., "INV-2026-0001"
  bookingId     String    @unique @map("booking_id")
  guestName     String
  guestEmail    String
  items         Json // detailed line items
  subtotal      Float
  taxAmount     Float     @map("tax_amount")
  discount      Float     @default(0)
  total         Float
  status        String    @default("pending") // pending, paid, overdue, cancelled
  dueDate       DateTime? @map("due_date")
  paidAt        DateTime? @map("paid_at")
  branchId      String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  booking Booking @relation(fields: [bookingId], references: [id])
  branch  Branch  @relation(fields: [branchId], references: [id])

  @@map("invoices")
}

model Tax {
  id        String   @id @default(cuid())
  name      String // VAT, Tourism Levy, etc.
  rate      Float // percentage
  type      String // percentage, fixed
  isActive  Boolean  @default(true) @map("is_active")
  branchId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  branch Branch @relation(fields: [branchId], references: [id])

  @@map("taxes")
}

model PriceRule {
  id         String    @id @default(cuid())
  name       String // Weekend Surge, Holiday Premium, etc.
  type       String // percentage, fixed
  value      Float
  startDate  DateTime? @map("start_date")
  endDate    DateTime? @map("end_date")
  daysOfWeek Json? // [0,6] for weekends
  roomType   String?   @map("room_type")
  isActive   Boolean   @default(true) @map("is_active")
  branchId   String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  // Relations
  branch Branch @relation(fields: [branchId], references: [id])

  @@map("price_rules")
}

// ============================================
// RESTAURANT & DINING
// ============================================

model Order {
  id          String   @id @default(cuid())
  orderNumber String?  @unique @map("order_number") // e.g., "ORD-001"
  tableNumber Int?     @map("table_number")
  guestName   String?  @map("guest_name")
  guestEmail  String?  @db.VarChar(100)
  guestPhone  String?  @db.VarChar(20)
  items       Json
  status      String   @default("pending") // pending, preparing, ready, served, cancelled
  total       Float
  subtotal    Float    @default(0)
  taxAmount   Float    @default(0)
  discountAmount Float @default(0)
  roomCharge  Boolean  @default(false) @map("room_charge")
  paymentStatus String @default("unpaid") // unpaid, paid, partial_paid, refunded
  paidAmount  Float    @default(0)
  notes       String?  @db.Text
  performedBy String?  @map("performed_by")
  branchId    String   @db.VarChar(50)
  roomId      String?  @map("room_id")
  guestId     String?  @map("guest_id")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  branch Branch @relation(fields: [branchId], references: [id])
  room   Room?  @relation(fields: [roomId], references: [id])
  guest  Guest? @relation(fields: [guestId], references: [id])
  staff  Staff? @relation("OrderCreator", fields: [performedBy], references: [id])

  @@index([orderNumber])
  @@index([branchId])
  @@index([status])
  @@index([paymentStatus])
  @@index([guestId])
  @@map("orders")
}

model RestaurantTable {
  id        String   @id @default(cuid())
  number    Int
  capacity  Int      @default(4)
  status    String   @default("available") // available, occupied, reserved
  positionX Int?     @map("position_x") // for floor plan
  positionY Int?     @map("position_y")
  branchId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  branch Branch @relation(fields: [branchId], references: [id])

  @@map("restaurant_tables")
}

model MenuItem {
  id            String   @id @default(cuid())
  name          String   @db.VarChar(200)
  nameFr        String?  @db.VarChar(200)
  nameSw        String?  @db.VarChar(200)
  slug          String   @db.VarChar(200)
  category      String   @db.VarChar(50)
  subcategory   String?  @db.VarChar(50)
  price         Float    @db.Float
  costPrice     Float?   @db.Float
  description   String?  @db.Text
  descriptionFr String?  @db.Text
  descriptionSw String?  @db.Text
  imageUrl      String?  @db.Text
  images        Json? // array of {url, uploadedAt, uploadedBy}
  available     Boolean  @default(true)
  popular       Boolean  @default(false)
  featured      Boolean  @default(false)
  vegetarian    Boolean  @default(false)
  vegan         Boolean  @default(false)
  spicy         Boolean  @default(false)
  spicyLevel    Int      @default(0)
  glutenFree    Boolean  @default(false)
  halal         Boolean  @default(false)
  organic       Boolean  @default(false)
  calories      Int?
  protein       Float?   @db.Float
  carbs         Float?   @db.Float
  fat           Float?   @db.Float
  allergens     Json?
  ingredients   Json?
  prepTime      Int?     @default(15)
  servingSize   String?  @db.VarChar(50)
  rating        Float    @default(0) @db.Float
  totalOrders   Int      @default(0)
  tags          Json?
  branchId      String   @db.VarChar(50)
  createdBy     String?  @db.VarChar(50) // staff ID of who created it
  lastModifiedBy String? @db.VarChar(50) // staff ID of who modified it
  isApproved    Boolean  @default(false) // managers add items pending approval
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  branch Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)

  @@index([branchId])
  @@index([category])
  @@index([available])
  @@index([popular])
  @@index([isApproved])
  @@map("menu_items")
}

// ============================================
// EVENTS & CONFERENCES
// ============================================

model Event {
  id               String   @id @default(cuid())
  name             String   @db.VarChar(200)
  type             String   @db.VarChar(50) // wedding, conference, meeting, party
  date             DateTime
  startTime        String   @map("start_time")
  endTime          String   @map("end_time")
  hall             String   @db.VarChar(100) // venue name
  capacity         Int
  attendees        Int      @default(0)
  status           String   @default("upcoming") @db.VarChar(20) // upcoming, ongoing, completed, cancelled
  totalAmount      Float    @default(0) @map("total_amount")
  paidAmount       Float    @default(0) @map("paid_amount")
  remainingAmount  Float    @default(0) @map("remaining_amount")
  paymentStatus    String   @default("pending") @db.VarChar(20) // pending, partial_paid, paid
  organizer        String   @db.VarChar(100)
  organizerContact String?  @map("organizer_contact") @db.VarChar(20)
  organizerEmail   String?  @map("organizer_email") @db.VarChar(100)
  description      String?  @db.Text
  notes            String?  @db.Text
  branchId         String   @db.VarChar(50)
  createdBy        String?  @db.VarChar(50)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  branch Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)

  @@index([branchId])
  @@index([status])
  @@index([paymentStatus])
  @@index([date])
  @@map("events")
}

// ============================================
// SPA & WELLNESS
// ============================================

model Service {
  id            String   @id @default(cuid())
  name          String
  nameFr        String?  @map("name_fr")
  nameSw        String?  @map("name_sw")
  type          String // massage, facial, treatment
  price         Float
  duration      Int // minutes
  description   String?  @db.Text
  descriptionFr String?  @map("description_fr")
  descriptionSw String?  @map("description_sw")
  imageUrl      String?  @map("image_url")
  available     Boolean  @default(true)
  branchId      String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  branch Branch @relation(fields: [branchId], references: [id])

  @@map("services")
}

// ============================================
// INVENTORY & STOCK
// ============================================

model Inventory {
  id              String    @id @default(cuid())
  name            String
  sku             String?   @unique
  category        String // food, beverage, housekeeping, maintenance
  quantity        Int
  unit            String // pieces, kg, liters
  unitPrice       Float     @map("unit_price")
  reorderLevel    Int       @map("reorder_level")
  supplier        String?
  supplierContact String?   @map("supplier_contact")
  expiryDate      DateTime? @map("expiry_date")
  branchId        String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  branch Branch @relation(fields: [branchId], references: [id])

  @@map("inventory")
}

model Expense {
  id          String   @id @default(cuid())
  category    String // salaries, utilities, supplies, maintenance, marketing
  amount      Float
  description String?  @db.Text
  vendor      String?
  receipt     String?  @map("receipt_url")
  date        DateTime
  branchId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  branch Branch @relation(fields: [branchId], references: [id])

  @@map("expenses")
}

// ============================================
// COMMUNICATION & MESSAGING
// ============================================

model Notification {
  id        String   @id @default(cuid())
  title     String
  message   String   @db.Text
  type      String // info, warning, success, error
  read      Boolean  @default(false)
  userId    String?
  branchId  String
  createdAt DateTime @default(now())

  // Relations
  branch Branch @relation(fields: [branchId], references: [id])

  @@map("notifications")
}

model ActivityLog {
  id        String   @id @default(cuid())
  userId    String?
  branchId  String
  action    String // create, update, delete, login, logout
  entity    String? // staff, booking, room, etc.
  entityId  String?  @map("entity_id")
  details   Json?
  ipAddress String?  @map("ip_address")
  createdAt DateTime @default(now())

  // Relations
  staff  Staff? @relation(fields: [userId], references: [id])
  branch Branch @relation(fields: [branchId], references: [id])

  @@map("activity_logs")
}

model Message {
  id           String   @id @default(cuid())
  sender       String // "guest" or "staff"
  senderName   String   @map("sender_name")
  senderEmail  String?  @map("sender_email")
  senderPhone  String?  @map("sender_phone")
  senderAvatar String?  @map("sender_avatar")
  message      String   @db.Text
  recipientId  String?  @map("recipient_id")
  branchId     String
  read         Boolean  @default(false)
  starred      Boolean  @default(false)
  archived     Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  branch Branch @relation(fields: [branchId], references: [id])

  @@map("messages")
}

model Contact {
  id         String   @id @default(cuid())
  name       String
  email      String
  phone      String?
  subject    String?
  message    String   @db.Text
  department String? // sales, support, reservations
  status     String   @default("pending") // pending, responded, resolved
  ipAddress  String?  @map("ip_address")
  userAgent  String?  @map("user_agent")
  branchId   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  branch Branch @relation(fields: [branchId], references: [id])

  @@map("contacts")
}

// ============================================
// CONTENT MANAGEMENT
// ============================================

model PageContent {
  id              String   @id @default(cuid())
  slug            String   @unique
  title           String
  titleFr         String?  @map("title_fr")
  titleSw         String?  @map("title_sw")
  subtitle        String?
  subtitleFr      String?  @map("subtitle_fr")
  subtitleSw      String?  @map("subtitle_sw")
  content         String   @db.Text
  contentFr       String?  @map("content_fr")
  contentSw       String?  @map("content_sw")
  imageUrl        String?  @map("image_url")
  gallery         Json?
  metaTitle       String?  @map("meta_title")
  metaDescription String?  @map("meta_description")
  published       Boolean  @default(true)
  branchId        String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  branch Branch @relation(fields: [branchId], references: [id])

  @@map("page_contents")
}

model HeroContent {
  id          String   @id @default(cuid())
  title       String   @db.VarChar(255)
  subtitle    String   @db.VarChar(255)
  description String   @db.Text
  imageUrl    String   @db.Text
  ctaText     String   @db.VarChar(100)
  ctaLink     String   @db.VarChar(255)
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  branchId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  branch Branch @relation(fields: [branchId], references: [id])

  @@index([branchId])
  @@index([isActive])
  @@map("hero_contents")
}

model RoomFeature {
  id          String   @id @default(cuid())
  name        String   @db.VarChar(100)
  description String   @db.Text
  icon        String   @db.VarChar(50)
  isModern    Boolean  @default(true)
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("room_features")
}

// ============================================
// REVIEWS & RATINGS
// ============================================

model Review {
  id          String   @id @default(cuid())
  type        String   @db.VarChar(20)
  rating      Int
  title       String?  @db.VarChar(200)
  comment     String?  @db.Text
  pros        String?  @db.Text
  cons        String?  @db.Text
  guestName   String   @db.VarChar(100)
  guestEmail  String?  @db.VarChar(100)
  guestAvatar String?  @db.Text
  images      Json?
  helpful     Int      @default(0)
  notHelpful  Int      @default(0)
  verified    Boolean  @default(false)
  response    String?  @db.Text
  respondedAt DateTime?
  branchId    String   @db.VarChar(50)
  roomId      String?  @db.VarChar(50)
  guestId     String?  @db.VarChar(50)
  isPublished Boolean  @default(false)
  isFeatured  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  branch Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)
  room   Room?  @relation(fields: [roomId], references: [id])
  guest  Guest? @relation(fields: [guestId], references: [id])

  @@index([branchId])
  @@index([type])
  @@index([rating])
  @@index([isPublished])
  @@map("reviews")
}

// ============================================
// PROMOTIONS & MARKETING
// ============================================

model Promotion {
  id          String    @id @default(cuid())
  code        String    @unique @db.VarChar(50)
  name        String    @db.VarChar(200)
  description String?   @db.Text
  type        String    @db.VarChar(20)
  value       Float     @db.Float
  minAmount   Float?    @db.Float
  maxDiscount Float?    @db.Float
  startDate   DateTime
  endDate     DateTime
  usageLimit  Int?
  usageCount  Int       @default(0)
  isActive    Boolean   @default(true)
  conditions  Json?
  branchId    String    @db.VarChar(50)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  branch   Branch    @relation(fields: [branchId], references: [id], onDelete: Cascade)
  bookings Booking[]

  @@index([code])
  @@index([branchId])
  @@index([isActive])
  @@map("promotions")
}

// ============================================
// ANALYTICS & REPORTING
// ============================================

model Analytics {
  id                String   @id @default(cuid())
  date              DateTime @db.Date
  branchId          String   @db.VarChar(50)
  totalRevenue      Float    @default(0) @db.Float
  totalBookings     Int      @default(0)
  totalGuests       Int      @default(0)
  occupancyRate     Float    @default(0) @db.Float
  avgRoomPrice      Float    @default(0) @db.Float
  totalOrders       Int      @default(0)
  restaurantRevenue Float    @default(0) @db.Float
  newGuests         Int      @default(0)
  returningGuests   Int      @default(0)
  cancellations     Int      @default(0)
  metadata          Json?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  branch Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)

  @@unique([date, branchId])
  @@index([branchId])
  @@index([date])
  @@map("analytics")
}

// ============================================
// SUPPLIER & PURCHASE ORDER MANAGEMENT
// ============================================

model Supplier {
  id              String    @id @default(cuid())
  name            String    @db.VarChar(200)
  contactPerson   String?   @db.VarChar(100)
  email           String?   @db.VarChar(100)
  phone           String?   @db.VarChar(20)
  address         String?   @db.Text
  city            String?   @db.VarChar(100)
  country         String?   @db.VarChar(100)
  category        String?   @db.VarChar(100) // food, beverages, supplies, equipment
  paymentTerms    String?   @db.VarChar(100)
  rating          Int?      @default(0)
  isActive        Boolean   @default(true)
  branchId        String    @db.VarChar(50)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  branch          Branch            @relation(fields: [branchId], references: [id], onDelete: Cascade)
  stockItems      StockItem[]
  purchaseOrders  PurchaseOrder[]

  @@index([branchId])
  @@index([isActive])
  @@index([category])
  @@map("suppliers")
}

model StockItem {
  id              String    @id @default(cuid())
  name            String    @db.VarChar(200)
  sku             String?   @db.VarChar(100)
  category        String    @db.VarChar(100)
  quantity        Int       @default(0)
  unit            String    @db.VarChar(50) // pieces, kg, liters, etc.
  unitPrice       Float     @db.Float
  reorderLevel    Int       @default(10)
  supplierId      String    @db.VarChar(50)
  expiryDate      DateTime?
  branchId        String    @db.VarChar(50)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  branch          Branch  @relation(fields: [branchId], references: [id], onDelete: Cascade)
  supplier        Supplier @relation(fields: [supplierId], references: [id], onDelete: Restrict)
  purchaseOrders  PurchaseOrderItem[]

  @@unique([sku, branchId])
  @@index([branchId])
  @@index([supplierId])
  @@index([category])
  @@map("stock_items")
}

model PurchaseOrder {
  id              String    @id @default(cuid())
  orderNumber     String    @unique @db.VarChar(100)
  supplierId      String    @db.VarChar(50)
  status          String    @default("pending") @db.VarChar(50) // pending, approved, ordered, received, cancelled
  subtotal        Float     @default(0) @db.Float
  taxAmount       Float     @default(0) @db.Float
  totalAmount     Float     @default(0) @db.Float
  orderDate       DateTime  @default(now())
  expectedDelivery DateTime?
  receivedDate    DateTime?
  branchId        String    @db.VarChar(50)
  createdById     String?   @db.VarChar(50)
  notes           String?   @db.Text
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  branch          Branch                @relation(fields: [branchId], references: [id], onDelete: Cascade)
  supplier        Supplier              @relation(fields: [supplierId], references: [id], onDelete: Restrict)
  items           PurchaseOrderItem[]

  @@index([branchId])
  @@index([supplierId])
  @@index([status])
  @@index([orderNumber])
  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id              String    @id @default(cuid())
  purchaseOrderId String    @db.VarChar(50)
  stockItemId     String    @db.VarChar(50)
  quantity        Int
  unitPrice       Float     @db.Float
  totalPrice      Float     @db.Float
  receivedQty     Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  stockItem       StockItem @relation(fields: [stockItemId], references: [id], onDelete: Restrict)

  @@index([purchaseOrderId])
  @@index([stockItemId])
  @@map("purchase_order_items")
}

// ============================================
// TASK & ASSIGNMENT MANAGEMENT
// ============================================

model Assignment {
  id          String    @id @default(cuid())
  staffId     String    @db.VarChar(50)
  type        String    @db.VarChar(50)
  entityId    String    @db.VarChar(50)
  status      String    @default("pending") @db.VarChar(20)
  priority    String    @default("medium") @db.VarChar(20)
  dueDate     DateTime?
  completedAt DateTime?
  notes       String?   @db.Text
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  staff Staff @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@index([staffId])
  @@index([status])
  @@map("assignments")
}

// ============================================
// SERVICE REQUESTS & HOUSEKEEPING
// ============================================

model ServiceRequest {
  id          String    @id @default(cuid())
  roomNumber  String    @db.VarChar(20)
  guestName   String    @db.VarChar(100)
  guestId     String?   @db.VarChar(50)
  type        String    @db.VarChar(50)
  request     String    @db.Text
  status      String    @default("pending") @db.VarChar(20)
  priority    String    @default("medium") @db.VarChar(20)
  assignedTo  String?   @db.VarChar(50)
  branchId    String    @db.VarChar(50)
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([branchId])
  @@index([status])
  @@index([priority])
  @@map("service_requests")
}

model HousekeepingTask {
  id                  String    @id @default(cuid())
  roomNumber          String    @db.VarChar(20)
  floor               Int
  type                String    @db.VarChar(50)
  status              String    @default("pending") @db.VarChar(20)
  priority            String    @default("medium") @db.VarChar(20)
  assignedTo          String?   @db.VarChar(100)
  startTime           DateTime?
  estimatedCompletion DateTime?
  completedAt         DateTime?
  notes               String?   @db.Text
  branchId            String    @db.VarChar(50)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  @@index([branchId])
  @@index([status])
  @@index([priority])
  @@map("housekeeping_tasks")
}
